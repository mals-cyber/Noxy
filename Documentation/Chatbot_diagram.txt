                            ┌────────────────────────────┐
                            │         USER CLIENT        │
                            │   (Web App / Mobile App)   │
                            └───────────────┬────────────┘
                                            │
                                        POST /chat
                                            │
                                            ▼
┌────────────────────────────────────────────────────────────────────────────────────────┐
│                                  FASTAPI BACKEND                                       │
│                                                                                        │
│  ┌──────────────────────────────┐         ┌──────────────────────────────────────────┐ │
│  │ Retrieve User & Conversation │         │     Save User Message to Database        │ │
│  └──────────────────────────────┘         └──────────────────────────────────────────┘ │
│                                      |                                                 │
│                                      ▼                                                 │
│      ┌──────────────────────────────────────────────────────────────────────────┐      │
│      │                            **NOXY AGENT**                                │      │
│      │                (LangChain Runnable Chain — LCEL)                         │      │
│      │──────────────────────────────────────────────────────────────────────────│      │
│      │ • Receives the user question                                             │      │
│      │ • Detects intent (greeting / HR / onboarding / gov forms / vague)        │      │
│      │ • Runs retrieval:                                                        │      │
│      │         → vector search from Chroma                                      │      │
│      │ • Builds final LLM prompt                                                │      │
│      └──────────────────────────────────────────────────────────────────────────┘      │
│                                      │                                                 │
│                       (only if needed, do retrieval)                                   │
│                                      ▼                                                 │
│              ┌──────────────────────────────────────────────────────────┐              │
│              │                Chroma Vector Database                    │              │
│              │      (semantic search: JSON, PDF, MD chunks)             │              │
│              └───────────────────────┬──────────────────────────────────┘              │
│                                      │ top-k chunks                                    │
│                                      ▼                                                 │
│      ┌──────────────────────────────────────────────────────────────────────────┐      │
│      │            NOXY AGENT merges chunks → builds LLM call input              │      │
│      └──────────────────────────────────────────────────────────────────────────┘      │
│                                      │                                                 │
│                                      ▼                                                 │
│      ┌──────────────────────────────────────────────────────────────────────────┐      │
│      │                 Azure GPT (Chat Completion API)                          │      │
│      │-----------------------------------------------------------------------  -│      │
│      │ • Receives system prompt + retrieved context + user question             │      │
│      │ • Generates final Noxy reply                                             │      │
│      └──────────────────────────────────────────────────────────────────────────┘      │
│                                      │                                                 │
│                         Save reply to Conversation DB                                  │
│                                      │                                                 │
└──────────────────────────────────────▼─────────────────────────────────────────────────┘
                                       │
                                       ▼
                                    Fast API
                        ┌───────────────────────────┐
                        │     RETURN JSON REPLY     │
                        │ {"User": "...", "Noxy": "..."} │
                        └───────────────────────────┘
